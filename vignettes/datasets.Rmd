---
title: "FIS-Broker Datasets"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{FIS-Broker Datasets}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Dataset Statistics

### By Type

```{r datasets_stats_type}
library(kwb.fisbroker)
fb_datasets <- kwb.fisbroker::get_dataset_overview()

fb_datasets %>%  
  dplyr::count(.data$type) %>% 
  dplyr::arrange(dplyr::desc(.data$n)) %>% 
  DT::datatable()
```

### By Type and Category

```{r datasets_stats_typecategory}
fb_datasets %>%  
  dplyr::count(
    .data$type,
    .data$category_name
  ) %>% 
  dplyr::arrange(dplyr::desc(.data$n)) %>% 
  DT::datatable()
```


## All Datasets 

### Dataset Names and Types

```{r fisbroker_datasets_names_and_types}
fb_datasets %>%  
  # dplyr::select(
  #   -.data$dataset_name_href,
  #   -.data$dataset_type_href
  # ) %>% 
  DT::datatable()
```

### Dataset Links

```{r fisbroker_datasets_links}
records <- fb_datasets[fb_datasets$type == "WMS", ][1:10, ]
metadata <- kwb.fisbroker:::read_all_metadata(records)

head(fb_datasets)

kwb.fisbroker:::lookup_dataset_id(
  overview = fb_datasets, 
  dataset_id = 3L, 
  type = "WMS"
)

fb_datasets %>% 
  dplyr::filter(.data$type %in% c("WMS", "WFS")) %>%
  dplyr::select(
    .data$dataset_id,
    .data$dataset_name,
    .data$type,
    .data$identifier
  ) %>% 
  DT::datatable()
```
